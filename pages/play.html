<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="/styles/custom.css">
        <title>Grant Hunt</title>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io('/play');

            socket.on('update', function(data){
                document.getElementById("status").innerHTML = data + ' User(s) connected<br>';
            });
            
            socket.on('player update', function(data){
                if(data > 0) {
                    document.getElementById("waitingstatus").innerHTML = "You've connected to a game! Waiting for " + data + " more players";
                    // alert(data)
                    // document.getElementById("copy").style.visibility = "visible";
                    document.getElementById("share-link").style.visibility = "visible";
                } else {
                    document.getElementById("waitingstatus").innerHTML = "The game has started!";
                }
            });
            
            socket.on('nonplayer update', function(data){
                document.getElementById("waitingstatus").innerHTML = "The current game is full. There are currently " + data + " players waiting.";
            });
            
            socket.on('start game', function(data){
                // console.log(JSON.stringify(card).toString());
                // hide share link button
                document.getElementById("share-link").style.visibility = "hidden";
                // get rid of loading dots
                document.getElementById("waitingstatus").classList.remove("loading");
                // remove status
                var parentOfStatus = document.getElementById("status").parentNode;
                parentOfStatus.removeChild(document.getElementById("status"));

                
                document.getElementById("waitingstatus").innerHTML = "The game has started!";

                // we need to show every player what their current hand is
                var card = document.createElement("div");
                card.setAttribute("class","card");
                var card_body = document.createElement("div")
                card_body.setAttribute("class","card-body");

                var cardTitle = document.createElement("h5");
                var cardText = document.createElement("p");

                cardText.style.color = "black";
                // cardText.appendChild(text);
                cardText.innerHTML = "player card: " + JSON.stringify(data);
                card_body.appendChild(cardTitle);
                card_body.appendChild(cardText);
                card.appendChild(card_body);

                document.getElementById("gamewindow").style.visibility = "visible";
                document.getElementById("card1").appendChild(card);
                // document.getElementById("card2").appendChild(dupCard);
                document.getElementById("turnstatus").innerHTML = "It's not your turn yet.";
                // document.getElementById("playbutton").onclick = function() {
                    // document.getElementById("turnstatus").innerHTML = "It's not your turn yet.";
                //     socket.emit('end turn');
                //     return false;
                // };

            });
            
            socket.on('your turn', function(currentPlayer, card){
                document.getElementById("turnstatus").innerHTML = "It's your turn!";

                // only show the end turn button if it's the current player's turn
                // var btn = document.createElement("button");
                // btn.appendChild(document.createTextNode("End Turn"));
                // btn.setAttribute("id","playbutton");
                // btn.setAttribute("onclick","endTurn()");
                // var gameWindow = document.getElementById("turnend");
                // gameWindow.appendChild(btn);
                document.getElementById("playbutton").style.visibility = "visible";

                // var card1 = document.getElementById("card1").childNodes;
                var card2 = document.getElementById("card2");
                // clone card1 and then update text inside to new card
                // for (var i = 0; i < card1.length; i++) {
                //     var temp = card1[i].cloneNode(true);
                //     card2.appendChild(temp);
                // }
                var cardData = document.createElement("div");
                cardData.setAttribute("class","card");
                var card_body = document.createElement("div")
                card_body.setAttribute("class","card-body");

                var cardTitle = document.createElement("h5");
                var cardText = document.createElement("p");

                cardText.style.color = "black";
                // cardText.appendChild(text);
                cardText.innerHTML = "player card: " + JSON.stringify(card);
                card_body.appendChild(cardTitle);
                card_body.appendChild(cardText);
                cardData.appendChild(card_body);

                card2.appendChild(cardData)
            });

            
            // function copyToClipboard(){
            //     var copyText = document.getElementById('copy');
            //     copyText.select();
            //     document.execCommand("copy");
            //     // alert(copyText.value);
            // }

            function copyToClipboard() {
                var textArea = document.createElement("textarea")
            
                textArea.value = window.location.href;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('Copy');

                document.body.removeChild(textArea);
            }

            function endTurn() {
                // alert("end turn");
                document.getElementById("playbutton").style.visibility = "hidden";
                document.getElementById("turnstatus").innerHTML = "It's not your turn yet.";
                // place holder
                socket.emit('play card', 8,1);

            }

            window.onbeforeunload = function() {
                return "";
            };
        </script>
    </head>
    <body>
    <nav class="navbar navbar-light fixed-top">
        <a class="navbar-left" href="/">
            <img src="/images/logo.png" width="200" alt="">
            <ul>
                <!-- <li><a href="play">Play</a></li> -->
                <li><a href="rules">Rules</a></li>
                <li><a href="/" style="color: #ff9300" onclick="confirmLeave()">Leave Game</a></li>
            </ul>
        </a>
    </nav>

    <header class="home-banner text-center text-black d-flex">
        <div class="container my-auto">
            <div class="row">
                <div class="col-lg-12 mx-auto" >
                    <p id="status" class="text-faded mb-5"></p>
                    <p id="waitingstatus" class="text-faded mb-5 loading"></p>
                        <div class="row" id="gamewindow" action="" style="visibility: hidden" >
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <p id="turnstatus" class="text-faded mb-5"></p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6" id="card1"></div>
                                    <div class="col-6" id="card2"></div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-12" id="turnend">
                                        <!-- <a class="button" id="playbutton" onclick="endTurn()">Play Card</a> -->
                                        <a class="button" id="playbutton" onclick="endTurn()" style="visibility: hidden;">Play Card</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>  
            </div>
            <!-- option 1 -->
            <div class='row'>
                <div class="col-lg-12 mx-auto">
                    <!-- <button class="copy-btn" id="share-link" onclick="copyToClipboard()" style="visibility: hidden;">Click to copy shareable 
                    link!</button> -->
                    <a class="button" id="share-link" onclick="copyToClipboard()" style="visibility: hidden;">Click to copy shareable link!</a>
                </div>
            </div>
            <!-- option 2 -->
            <!-- <div class="row">
                <div class="col-lg-12 mx-auto">
                    <input class="text" id="copy" value="test" style="visibility: hidden" readonly/>
                    <button class='copy-btn' id="share-link" style="visibility: hidden" onclick="copyToClipboard()">Copy</button>
                </div>
            </div> -->
        </div>
    </header>
    
    </body>
</html>